"use strict";(self.webpackChunkpodo_log=self.webpackChunkpodo_log||[]).push([[670],{1670:function(e,n,t){t.r(n),t.d(n,{default:function(){return L}});var r=t(2791),i=t(5102),a=t(2120),c=t(8561),s=t(2490),u=t(1413),o=t(4165),l=t(5861),d=t(9439),f=t(5330),g=t(1134),p=(0,f.cn)({key:"diaryRevisionImgAtom",default:""}),m=t(4248),h=t(6582),x=t(8593),v=t(3360),j=t(7964),k=t(184),Z=function(e){var n=e.ogPicSrc,t=e.imgRef,r=e.saveImgFile,i=e.handlePicChanged,a="\uc5c6\uc74c"===n?null:n;return(0,k.jsx)(k.Fragment,{children:a?(0,k.jsxs)("div",{className:"relative overflow-auto",children:[a&&(0,k.jsx)(j.xn,{alt:"picture",src:a}),(0,k.jsx)(j.Ms,{onClick:function(){i()},src:v})]}):(0,k.jsxs)(j.FJ,{onClick:function(){var e;return null===t||void 0===t||null===(e=t.current)||void 0===e?void 0:e.click()},children:[(0,k.jsx)(j.vw,{alt:"upload",src:x}),(0,k.jsx)("input",{className:"hidden",type:"file",accept:"image/bmp,image/jpeg, image/jpg, image/png, image/heic, image/gif",onChange:function(){r(),i()},ref:t})]})})},b=function(e){var n=e.diaryImg,t=e.imgPreview,r=e.deleteImgFile,i=e.saveImgFile,a=e.imgRef;return(0,k.jsx)(k.Fragment,{children:n?(0,k.jsxs)("div",{className:"relative overflow-auto",children:[(0,k.jsx)(j.xn,{src:t||x}),(0,k.jsx)(j.Ms,{onClick:r,src:v})]}):(0,k.jsxs)(j.FJ,{onClick:function(){var e;return null===a||void 0===a||null===(e=a.current)||void 0===e?void 0:e.click()},children:[(0,k.jsx)(j.vw,{alt:"upload",src:x}),(0,k.jsx)("input",{className:"hidden",type:"file",accept:"image/bmp,image/jpeg, image/jpg, image/png, image/heic, image/gif",id:"profileImg",onChange:i,ref:a})]})})},w=function(e){var n=e.ogPicSrc,t=e.isPicChanged,i=e.handlePicChanged,a=new FileReader,c=(0,r.useRef)(null),s=(0,f.FV)(p),u=(0,d.Z)(s,2),g=u[0],x=u[1],v=(0,f.rb)(p),j=(0,r.useState)(""),w=(0,d.Z)(j,2),y=w[0],I=w[1],C=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var n,t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===c||void 0===c||null===(n=c.current)||void 0===n||!n.files){e.next=13;break}if(t=c.current.files[0],!(0,h.T)(t)){e.next=6;break}return e.next=5,(0,h.K)(t);case 5:t=e.sent;case 6:return e.next=8,(0,m._)(t);case 8:(r=e.sent)&&(t=r),x(t),a.readAsDataURL(t),a.onloadend=function(){I(a.result)};case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){return function(){v()}}),[]),(0,k.jsx)(k.Fragment,{children:t?(0,k.jsx)(b,{imgRef:c,diaryImg:g,imgPreview:y,deleteImgFile:function(){"string"===typeof g&&URL.revokeObjectURL(g),x("")},saveImgFile:C}):(0,k.jsx)(Z,{imgRef:c,ogPicSrc:n,saveImgFile:C,handlePicChanged:i})})},y=t(5188),I=t(1590),C=t(5978),F=t(7689),P=t(7596),S=function(e){var n=new FormData;return n.append("picture",e),n},R=function(){var e=(0,F.s0)(),n=(0,F.UO)(),t=String(n.bookId),i=String(n.diaryId),a=(0,f.sJ)(p),c=(0,r.useState)(!1),s=(0,d.Z)(c,2),m=s[0],h=s[1],x=(0,r.useState)(null),v=(0,d.Z)(x,2),j=v[0],Z=v[1],b=(0,g.cI)({defaultValues:function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var n,r,a,c,s,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.h.get(y.T.bookDiary(Number(t))+"/".concat(i));case 2:return n=e.sent,r=n.data,a=r.data,c=a.title,s=a.picture,u=a.content,Z({title:c,picture:s,content:u}),e.abrupt("return",{title:c,content:u});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),R=b.register,L=b.handleSubmit,N=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==a){e.next=4;break}return e.next=3,I.h.delete(y.T.diaryImg(i));case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,C.V.post(y.T.diaryImg(i),S(a));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var n=(0,l.Z)((0,o.Z)().mark((function n(t){var r,a;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.title,a=t.content,n.prev=1,n.next=4,I.h.patch(y.T.diary+"/".concat(i),{title:r,content:a});case 4:if(!m){n.next=7;break}return n.next=7,N();case 7:e(-2),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),n.t0 instanceof Error&&alert(n.t0.message);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})));return function(e){return n.apply(this,arguments)}}();return(0,k.jsxs)(P.bw,{id:"diary",onSubmit:L(T),children:[(0,k.jsx)(P.Gl,(0,u.Z)({className:"".concat(P.hG),placeholder:"\uc81c\ubaa9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.",minLength:2,maxLength:30,required:!0},R("title"))),j&&(0,k.jsx)(w,{ogPicSrc:j.picture,isPicChanged:m,handlePicChanged:function(){h(!0)}}),(0,k.jsx)(P.mi,(0,u.Z)({className:"".concat(P.hG),placeholder:"\ub0b4\uc6a9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.",minLength:2,maxLength:400,required:!0},R("content")))]})},L=function(){return(0,k.jsxs)(i.q,{children:[(0,k.jsx)(a.Z,{}),(0,k.jsx)(s.Z,{}),(0,k.jsx)(c.Z,{title:"\uc77c\uae30 \uc218\uc815"}),(0,k.jsx)(R,{})]})}}}]);
//# sourceMappingURL=670.c92062bf.chunk.js.map